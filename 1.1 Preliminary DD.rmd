---
title: "1.1 Preliminary DD"
author: "TG"
date: "2022-12-05"
output:
   prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
library(rfishbase)
library(Hmisc)
library(vegan)
library(mobr)
library(viridis)
```

```{r}

medata_raw <- readRDS("G:/My Drive/PHD/chapter 3 MPA dd/Meddata-DD/data/medata.Rds") # the original data (not really the row-row one)

medata<-medata_raw # the verstion ill play with
```

convert to wide


```{r}
medata<-medata %>% select(1:21)
medata<-medata %>% group_by(across(1:20)) %>% summarise(amount = sum(sp.n))
medata_wide<-spread(medata,species,amount,fill = 0)

```


convert to presence/absence

```{r}


medata_wide[,20:142]<-decostand(medata_wide[,20:142],method = "pa") 

```


crate different sp matrix that contains the beal index value for each species

Beals smoothing replaces each entry in the community data with a probability of a target species occurring in that particular site, based on the joint occurrences of the target species with the species that actually occur in the site. 

```{r}
beals <- medata_wide 

beals[,20:142] <- beals(beals[,20:142],include = FALSE) 


```

```{r}
boxplot(unlist(beals[,20:142]) ~ unlist(medata_wide[,20:142]), xlab="Presence", ylab="Beals")

```


see for each species if it was present or absent form a site/year along side with its Beals probability  

```{r}
g_beals <-gather(beals,"Species","beal",20:ncol(beals))
g_beals<-g_beals %>% arrange(site,trans)

g_pa<-gather(medata_wide,"Species","pa",20:ncol(medata_wide))
g_pa<-g_pa %>% arrange(site,trans)

dark_diversity<-left_join(g_beals,g_pa) 

```


